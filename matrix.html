<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Truth Network | CybrJustice</title>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="matrix.css">
  
  <!-- Keep your system scripts -->
  <script>
    window.A = window.A || {};
    
    window.A.log = function() {
      if (console && console.log) {
        console.log.apply(console, ['[CYBR]'].concat(Array.from(arguments)));
      }
    };
  </script>
</head>
<body class="matrix">
  <!-- Matrix digital rain background -->
  <canvas id="matrix-rain"></canvas>
  
  <div class="interface-container">
    <header class="matrix-header">
      <div class="logo-container">
        <h1 class="matrix-logo">CYBR<span>JUSTICE</span></h1>
        <p class="matrix-subtitle">THE TRUTH NETWORK</p>
      </div>
    </header>
    
    <main>
      <!-- AI Control Panel (Hidden by Default) -->
      <div class="ai-control-panel hidden">
        <div class="model-selector">
          <label for="model-select">Select AI Model:</label>
          <select id="model-select" class="matrix-select">
            <!-- Models will be populated here -->
          </select>
        </div>
        
        <div class="prompt-input">
          <label for="system-prompt">System Prompt:</label>
          <textarea id="system-prompt" class="matrix-textarea" placeholder="Enter custom system prompt..."></textarea>
        </div>
      </div>
      
      <div class="terminal-container">
        <div class="terminal-header">
          <span>cybr://>root@truthengine</span>
          <div class="terminal-controls">
            <span class="minimize">_</span>
            <span class="maximize">□</span>
            <span class="close">×</span>
          </div>
        </div>
        
        <div class="terminal-body">
          <div class="terminal-history" id="terminal-output">
            <p>> Initializing truth protocol...</p>
            <p>> Establishing secure connection...</p>
            <p>> Identity verification complete.</p>
            <p>> Welcome to the Truth Network.</p>
            <p>> "The truth is out there, but so are lies." - Anonymous</p>
            <p>> Type 'help' for available commands.</p>
          </div>
          
          <div class="terminal-input-line">
            <span class="prompt">$</span>
            <input type="text" id="truth-input" class="terminal-input" placeholder="uncover the truth" autocomplete="off">
          </div>
        </div>
      </div>
      
      <div class="truth-results" id="truth-results">
        <!-- Results will appear here -->
      </div>
      
      <div class="confidence-meter">
        <div class="confidence-label">TRUTH CONFIDENCE</div>
        <div class="confidence-bar">
          <div class="confidence-level" id="confidence-level"></div>
        </div>
        <div class="confidence-value" id="confidence-value">0%</div>
      </div>
      
      <div class="truth-controls">
        <button class="matrix-button" id="verify-btn">VERIFY</button>
        <button class="matrix-button" id="contribute-btn">CONTRIBUTE</button>
        <button class="matrix-button" id="network-btn">NETWORK</button>
      </div>
    </main>
  </div>
  
  <!-- Matrix rain animation script -->
  <script>
    // Matrix digital rain effect
    document.addEventListener('DOMContentLoaded', function() {
      const canvas = document.getElementById('matrix-rain');
      const ctx = canvas.getContext('2d');
      
      // Set canvas size
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      // Characters for the Matrix digital rain
      const chars = "アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
      
      // Array to track drops
      const fontSize = 16;
      const columns = canvas.width / fontSize;
      const drops = [];
      
      // Initialize drops
      for (let i = 0; i < columns; i++) {
        drops[i] = 1;
      }
      
      // Draw the Matrix rain
      function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; // Trail effect
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#00FF41'; // Matrix green
        ctx.font = fontSize + 'px monospace';
        
        // Draw characters
        for (let i = 0; i < drops.length; i++) {
          // Random character
          const text = chars.charAt(Math.floor(Math.random() * chars.length));
          
          // Draw the character
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);
          
          // Reset if bottom reached or random chance
          if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
            drops[i] = 0;
          }
          
          // Move it down
          drops[i]++;
        }
      }
      
      // Animation loop
      setInterval(draw, 33);
      
      // Get references to UI elements
      const truthInput = document.getElementById('truth-input');
      const terminalOutput = document.getElementById('terminal-output');
      const truthResults = document.getElementById('truth-results');
      const confidenceLevel = document.getElementById('confidence-level');
      const confidenceValue = document.getElementById('confidence-value');
      const modelSelect = document.getElementById('model-select');
      const systemPromptInput = document.getElementById('system-prompt');
      const aiControlPanel = document.querySelector('.ai-control-panel');
      
      // Function to populate the model select dropdown
      function populateModelSelect(models) {
        modelSelect.innerHTML = '';
        models.forEach(model => {
          const option = document.createElement('option');
          option.value = model.id;
          option.textContent = model.name;
          modelSelect.appendChild(option);
        });
      }
      
      // Function to run AI inference
      function runAIInference(query, systemPrompt, modelId) {
        // Add to terminal history
        const newLine = document.createElement('p');
        newLine.innerHTML = `> <span class="user-input">${query}</span>`;
        terminalOutput.appendChild(newLine);
        
        // Clear input
        truthInput.value = '';
        
        // Processing message
        const processingLine = document.createElement('p');
        processingLine.textContent = '> Analyzing truth patterns...';
        terminalOutput.appendChild(processingLine);
        
        // Simulate truth analysis
        setTimeout(() => {
          // Show result
          const resultLine = document.createElement('p');
          resultLine.textContent = '> Analysis complete.';
          terminalOutput.appendChild(resultLine);
          
          // Scroll to bottom of terminal
          terminalOutput.scrollTop = terminalOutput.scrollHeight;
          
          // Show in results area
          simulateTruthResult(query);
        }, 1500);
      }
      
      // Simulate truth result
      function simulateTruthResult(query) {
        // Random confidence value between 40-98%
        const confidence = Math.floor(Math.random() * 58) + 40;
        
        // Update confidence meter
        confidenceLevel.style.width = `${confidence}%`;
        confidenceValue.textContent = `${confidence}%`;
        
        // Color based on confidence
        if (confidence < 60) {
          confidenceLevel.className = 'confidence-level low';
        } else if (confidence < 85) {
          confidenceLevel.className = 'confidence-level medium';
        } else {
          confidenceLevel.className = 'confidence-level high';
        }
        
        // Create result
        truthResults.innerHTML = `
          <div class="truth-result-header">
            <h3>TRUTH ANALYSIS</h3>
            <div class="truth-metadata">
              <span class="truth-source">SOURCES: MULTIPLE</span>
              <span class="truth-timestamp">TIMESTAMP: ${new Date().toISOString()}</span>
            </div>
          </div>
          <div class="truth-result-body">
            <p>Query: "${query}"</p>
            <p>The collective truth network has analyzed this statement.</p>
            <p>Based on available information, this appears to be 
              <span class="${confidence < 60 ? 'low-truth' : confidence < 85 ? 'partial-truth' : 'high-truth'}">
                ${confidence < 60 ? 'POTENTIALLY MISLEADING' : confidence < 85 ? 'PARTIALLY ACCURATE' : 'HIGHLY ACCURATE'}
              </span>.
            </p>
            <p>Community consensus: ${confidence}% confidence rating.</p>
            <p>Would you like to contribute additional context or evidence?</p>
          </div>
        `;
        
        // Show results
        truthResults.classList.add('active');
      }
      
      // Function to handle terminal commands
      function handleCommand(command) {
        switch (command) {
          case 'help':
            addTerminalOutput([
              '> Available commands:',
              '> - help: Show available commands',
              '> - ai-controls: Toggle AI control panel',
              '> - run-inference: Run AI inference with current settings'
            ]);
            break;
          case 'ai-controls':
            aiControlPanel.classList.toggle('hidden');
            break;
          case 'run-inference':
            const query = truthInput.value.trim();
            if (query) {
              runAIInference(query, systemPromptInput.value.trim(), modelSelect.value);
            } else {
              addTerminalOutput(['> Error: No query entered.']);
            }
            break;
          default:
            addTerminalOutput([`> Error: Unknown command '${command}'`]);
        }
      }
      
      // Function to add output to the terminal
      function addTerminalOutput(lines) {
        lines.forEach(line => {
          const newLine = document.createElement('p');
          newLine.textContent = line;
          terminalOutput.appendChild(newLine);
        });
        terminalOutput.scrollTop = terminalOutput.scrollHeight;
      }
      
      // Event listener for terminal input
      truthInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
          const command = truthInput.value.trim();
          addTerminalOutput([`> <span class="user-input">${command}</span>`]);
          handleCommand(command);
          truthInput.value = '';
        }
      });
      
      // Populate Model Select
      populateModelSelect([
        { id: 'mistral/ministral-8b', name: 'Ministral 8B' },
        { id: 'openai/gpt-4o-mini', name: 'GPT-4o mini' },
        { id: 'google/gemini-flash-1.5-8b', name: 'Gemini Flash 1.5 8B' },
        { id: 'meta-llama/llama-3.1-8b-instruct', name: 'Llama 3.1 8B Instruct' }
      ]);
    });
  </script>
  
  <style>
    /* Style for hiding the AI control panel */
    .ai-control-panel.hidden {
      display: none;
    }
    
    /* Style for user input in terminal */
    .user-input {
      color: #FFFF00; /* Yellow */
    }
  </style>
</body>
</html>
